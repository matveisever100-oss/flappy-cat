<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Flappy Cat ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ</title>
<style>
  :root{
    --bg:#a8e6ff;
    --ground:#d2b48c;
    --pipe:#2e8b57;
    --font: "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%; margin:0; background:var(--bg); font-family:var(--font);}
  .wrap{height:100%; display:flex; align-items:center; justify-content:center; padding:20px;}
  canvas{background:linear-gradient(#b8f0ff,#70c5ce); border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.25); touch-action:none;}
  .overlay{position:fixed; left:20px; top:20px; color:#023; text-shadow:0 1px 0 #fff7;}
  .hint{position:fixed; right:20px; top:20px; background:rgba(255,255,255,0.6); padding:6px 10px; border-radius:8px;}
  .levelselect{
    position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
    background:#fff; padding:20px 24px; border-radius:16px; box-shadow:0 6px 30px rgba(0,0,0,0.3);
    text-align:center; font-size:18px; display:none;
  }
  .levelselect button{
    margin:6px; padding:10px 18px; border:none; border-radius:10px; cursor:pointer; font-size:16px;
    background:#70c5ce; color:#fff; box-shadow:0 3px 8px rgba(0,0,0,0.25);
  }
  .levelselect button:hover{background:#5eb0b9;}
  .credits{position:fixed; left:20px; bottom:14px; color:#033; opacity:0.8; font-size:13px;}
</style>
</head>
<body>
<div class="wrap"><canvas id="game"></canvas></div>
<div class="overlay" id="scoreOverlay">–°—á—ë—Ç: 0 ¬∑ –†–µ–∫–æ—Ä–¥: 0</div>
<div class="hint">–ü—Ä–æ–±–µ–ª / –∫–ª–∏–∫ / —Ç–∞–ø ‚Äî –ø–æ–¥–ø—Ä—ã–≥–Ω—É—Ç—å</div>
<div class="credits">Flappy Cat üêæ ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</div>

<div class="levelselect" id="levelMenu">
  <h3>–í—ã–±–µ—Ä–∏ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h3>
  <button data-level="easy">–õ—ë–≥–∫–∏–π</button>
  <button data-level="medium">–°—Ä–µ–¥–Ω–∏–π</button>
  <button data-level="hard">–°–ª–æ–∂–Ω—ã–π</button>
</div>

<script>
/* ---------------- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ---------------- */
const CONFIG = {
  width:480,
  heightRatio:1.6,
  gravity:1200,
  flapSpeed:-360,
  pipeSpeed:160,
  pipeGap:140,
  pipeInterval:1400,
  pipeWidth:72,
  groundHeight:90,
  catSize:28,
};
const LEVELS = {
  easy:   {speed:160, gap:160, gravity:1100, label:"–õ—ë–≥–∫–∏–π"},
  medium: {speed:190, gap:130, gravity:1250, label:"–°—Ä–µ–¥–Ω–∏–π"},
  hard:   {speed:230, gap:110, gravity:1400, label:"–°–ª–æ–∂–Ω—ã–π"},
};

/* ---------------- Canvas ---------------- */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d', { alpha:false });
let DPR = Math.max(1, window.devicePixelRatio || 1);
function resizeCanvas(){
  const maxW = Math.min(window.innerWidth - 40, 900);
  const W = Math.max(320, maxW);
  const H = Math.round(W * CONFIG.heightRatio);
  canvas.style.width = W + "px";
  canvas.style.height = H + "px";
  canvas.width = Math.round(W * DPR);
  canvas.height = Math.round(H * DPR);
  ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

/* ---------------- –£—Ç–∏–ª–∏—Ç—ã —Ä–∏—Å–æ–≤–∞–Ω–∏—è ---------------- */
function roundRectPath(ctx, x, y, w, h, r){
  // r –º–æ–∂–µ—Ç –±—ã—Ç—å —á–∏—Å–ª–æ –∏–ª–∏ –æ–±—ä–µ–∫—Ç; —É–ø—Ä–æ—Å—Ç–∏–º: —á–∏—Å–ª–æ —Ä–∞–¥–∏—É—Å–∞
  if (r < 0) r = 0;
  const radius = Math.min(r, w/2, h/2);
  ctx.beginPath();
  ctx.moveTo(x + radius, y);
  ctx.lineTo(x + w - radius, y);
  ctx.arcTo(x + w, y, x + w, y + radius, radius);
  ctx.lineTo(x + w, y + h - radius);
  ctx.arcTo(x + w, y + h, x + w - radius, y + h, radius);
  ctx.lineTo(x + radius, y + h);
  ctx.arcTo(x, y + h, x, y + h - radius, radius);
  ctx.lineTo(x, y + radius);
  ctx.arcTo(x, y, x + radius, y, radius);
  ctx.closePath();
}

/* ---------------- Audio ---------------- */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx;
function beep(freq=440, dur=0.06, type='sine', vol=0.08){
  if(!AudioCtx) return;
  if(!audioCtx) audioCtx = new AudioCtx();
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type; o.frequency.value = freq;
  g.gain.value = vol; o.connect(g); g.connect(audioCtx.destination);
  o.start();
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
  o.stop(audioCtx.currentTime + dur + 0.02);
}

/* ---------------- –°—É—â–Ω–æ—Å—Ç–∏: –∫–æ—Ç –∏ —Ç—Ä—É–±—ã ---------------- */
class Cat {
  constructor(x,y){ this.x = x; this.y = y; this.vy = 0; }
  flap(){ this.vy = CONFIG.flapSpeed; beep(880, 0.05, 'triangle', 0.06); }
  update(dt){ this.vy += CONFIG.gravity * dt; this.y += this.vy * dt; }
  draw(ctx){
    const s = CONFIG.catSize;
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(Math.max(-0.5, Math.min(0.8, this.vy / 700)));
    // —Ç–µ–ª–æ (—Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫)
    ctx.fillStyle = "#FFD599";
    ctx.strokeStyle = "#b0702d";
    ctx.lineWidth = 2;
    roundRectPath(ctx, -s/1.2, -s/1.3, s*1.6, s*1.4, 8);
    ctx.fill(); ctx.stroke();
    // —É—à–∫–∏
    ctx.beginPath();
    ctx.moveTo(-s*0.6,-s*0.9);
    ctx.lineTo(-s*0.2,-s*1.5);
    ctx.lineTo(s*0.1,-s*0.9);
    ctx.closePath();
    ctx.fillStyle = "#ffb347"; ctx.fill(); ctx.stroke();
    // –≥–ª–∞–∑–∞
    ctx.fillStyle = "#333";
    ctx.beginPath(); ctx.arc(s*0.4, -s*0.3, 3, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(s*0.7, -s*0.3, 3, 0, Math.PI*2); ctx.fill();
    // —Ö–≤–æ—Å—Ç (–ø—Ä–æ—Å—Ç–∞—è –∫—Ä–∏–≤–∞—è)
    ctx.beginPath();
    ctx.strokeStyle = "#cc7b3a";
    ctx.lineWidth = 5;
    ctx.moveTo(-s*0.9, s*0.2);
    ctx.quadraticCurveTo(-s*1.3, s*0.1, -s*1.4, s*0.6);
    ctx.stroke();
    ctx.restore();
  }
  getBounds(){ return { x: this.x, y: this.y, r: CONFIG.catSize * 0.8 }; }
}

class Pipe {
  constructor(x, top, gap, w){ this.x = x; this.top = top; this.gap = gap; this.w = w; this.passed = false; }
  update(dt){ this.x -= CONFIG.pipeSpeed * dt; }
  draw(ctx, H){
    ctx.fillStyle = "#2e8b57";
    ctx.fillRect(this.x, 0, this.w, this.top);
    const bottomY = this.top + this.gap;
    ctx.fillRect(this.x, bottomY, this.w, H - bottomY - CONFIG.groundHeight);
    // –ª—ë–≥–∫–∞—è —Ç–µ–Ω—å
    ctx.fillStyle = 'rgba(0,0,0,0.06)';
    ctx.fillRect(this.x, Math.max(0, this.top - 8), this.w, 8);
  }
  collides(cat){
    const c = cat.getBounds();
    if (c.x + c.r > this.x && c.x - c.r < this.x + this.w){
      if (c.y - c.r < this.top || c.y + c.r > this.top + this.gap) return true;
    }
    return false;
  }
}

/* ---------------- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ---------------- */
let cat, pipes = [], lastPipe = 0, running = false, gameOver = false;
let score = 0, best = parseInt(localStorage.getItem('flappycat_best') || '0', 10);
let currentLevel = LEVELS.easy;
const scoreOverlay = document.getElementById('scoreOverlay');
const levelMenu = document.getElementById('levelMenu');

function updateOverlay(){ scoreOverlay.textContent = `–°—á—ë—Ç: ${score} ¬∑ –†–µ–∫–æ—Ä–¥: ${best} (${currentLevel.label})`; }

/* ---------------- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è / –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç—Ä—É–± ---------------- */
function resetGame(){
  const W = canvas.clientWidth, H = canvas.clientHeight;
  cat = new Cat(W * 0.25, H * 0.5);
  pipes = [];
  lastPipe = performance.now();
  running = true;
  gameOver = false;
  score = 0;
  // –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É—Ä–æ–≤–Ω—è –≤ CONFIG (–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è)
  CONFIG.pipeSpeed = currentLevel.speed;
  CONFIG.gravity = currentLevel.gravity;
  CONFIG.pipeGap = currentLevel.gap;
  updateOverlay();
}

function spawnPipe(){
  const H = canvas.clientHeight;
  const minTop = 40;
  // –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–∞–∫—Å–∏–º—É–º: –Ω–µ –¥–æ–ø—É—Å—Ç–∏—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω
  const maxTop = Math.max(minTop + 10, H - CONFIG.groundHeight - CONFIG.pipeGap - 80);
  const top = Math.floor(minTop + Math.random() * Math.max(0, maxTop - minTop));
  pipes.push(new Pipe(canvas.clientWidth + 10, top, CONFIG.pipeGap, CONFIG.pipeWidth));
}

/* ---------------- –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è ---------------- */
function checkCollision(){
  const H = canvas.clientHeight;
  if (cat.y + CONFIG.catSize / 1.3 >= H - CONFIG.groundHeight) return true;
  if (cat.y - CONFIG.catSize / 1.3 <= 0) return true;
  for (const p of pipes) if (p.collides(cat)) return true;
  return false;
}

/* ---------------- –†–µ–Ω–¥–µ—Ä ---------------- */
function drawBackground(ctx){
  const W = canvas.clientWidth, H = canvas.clientHeight;
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'#b8f0ff'); g.addColorStop(1,'#70c5ce');
  ctx.fillStyle = g; ctx.fillRect(0,0,W,H);
}
function drawGround(ctx){
  const W = canvas.clientWidth, H = canvas.clientHeight;
  ctx.fillStyle = "#d2b48c";
  ctx.fillRect(0, H - CONFIG.groundHeight, W, CONFIG.groundHeight);
}
function drawUI(ctx){
  if (!running && !gameOver){
    ctx.save();
    ctx.fillStyle = "rgba(255,255,255,0.95)";
    ctx.font = "20px sans-serif";
    ctx.textAlign = "center";
    ctx.fillText("–ö–ª–∏–∫–Ω–∏—Ç–µ / –ø—Ä–æ–±–µ–ª —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å", canvas.clientWidth/2, canvas.clientHeight*0.5);
    ctx.restore();
  }
  if (gameOver){
    ctx.save();
    ctx.fillStyle = "rgba(0,0,0,0.6)";
    ctx.fillRect(0,0,canvas.clientWidth,canvas.clientHeight);
    ctx.fillStyle = "#fff";
    ctx.textAlign = "center";
    ctx.font = "bold 42px system-ui";
    ctx.fillText("–ú—è—É! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞", canvas.clientWidth/2, canvas.clientHeight*0.4);
    ctx.font = "20px system-ui";
    ctx.fillText(`–°—á—ë—Ç: ${score} ¬∑ –†–µ–∫–æ—Ä–¥: ${best}`, canvas.clientWidth/2, canvas.clientHeight*0.5);
    ctx.fillText("–ü—Ä–æ–±–µ–ª / –∫–ª–∏–∫ ‚Äî –∑–∞–Ω–æ–≤–æ", canvas.clientWidth/2, canvas.clientHeight*0.62);
    ctx.restore();
  }
}

/* ---------------- –¶–∏–∫–ª ---------------- */
let last = performance.now();
function loop(ts){
  const dt = Math.min(0.033, (ts - last) / 1000);
  last = ts;

  if (running){
    cat.update(dt);

    if (ts - lastPipe > CONFIG.pipeInterval){
      spawnPipe();
      lastPipe = ts;
    }

    pipes.forEach(p => p.update(dt));
    pipes = pipes.filter(p => p.x + p.w > -20);

    pipes.forEach(p => {
      if (!p.passed && cat.x > p.x + p.w){
        p.passed = true;
        score++;
        beep(1200 - Math.min(600, score * 10), 0.03, 'sine', 0.05);
        if (score > best){ best = score; localStorage.setItem('flappycat_best', String(best)); }
        // –ø–ª–∞–≤–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø–æ —Å—á—ë—Ç—É (–Ω–µ –ª–æ–º–∞–µ—Ç –±–∞–∑–æ–≤—É—é —Å–∫–æ—Ä–æ—Å—Ç—å —É—Ä–æ–≤–Ω—è)
        CONFIG.pipeSpeed = currentLevel.speed + score * 3;
        updateOverlay();
      }
    });

    if (checkCollision()){
      running = false;
      gameOver = true;
      beep(200, 0.28, 'sawtooth', 0.15);
    }
  }

  ctx.clearRect(0,0,canvas.clientWidth,canvas.clientHeight);
  drawBackground(ctx);
  pipes.forEach(p => p.draw(ctx, canvas.clientHeight));
  if (cat) cat.draw(ctx);
  drawGround(ctx);
  drawUI(ctx);

  requestAnimationFrame(loop);
}

/* ---------------- –í–≤–æ–¥ ---------------- */
function doFlapOrStart(){
  // —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–≤—É–∫–∞ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
  if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{});
  if (!running && !gameOver){
    running = true;
    cat && cat.flap();
    return;
  }
  if (running && !gameOver){
    cat && cat.flap();
  } else if (gameOver){
    // –ø—Ä–∏ gameOver –ø–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —É—Ä–æ–≤–Ω—è (—Ä–µ—Å—Ç–∞—Ä—Ç —á–µ—Ä–µ–∑ –≤—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è)
    showLevelMenu();
  }
}

window.addEventListener('keydown', e => {
  if (e.code === 'Space') { e.preventDefault(); doFlapOrStart(); }
});
canvas.addEventListener('mousedown', () => doFlapOrStart());
canvas.addEventListener('touchstart', e => { e.preventDefault(); doFlapOrStart(); }, { passive: false });

// —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–≤—É–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ (–ø–æ–ª–∏—Ç–∏–∫–∞ –∞–≤—Ç–æ–ø—Ä–æ–∏–≥—Ä—ã—à–∞)
document.body.addEventListener('click', function unlockAudio(){
  if (!audioCtx && AudioCtx) audioCtx = new AudioCtx();
  if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{});
  document.body.removeEventListener('click', unlockAudio);
});

/* ---------------- –ú–µ–Ω—é —É—Ä–æ–≤–Ω–µ–π ---------------- */
function showLevelMenu(){
  running = false; gameOver = false;
  levelMenu.style.display = 'block';
}
levelMenu.querySelectorAll('button').forEach(btn => {
  btn.onclick = () => {
    const key = btn.dataset.level;
    if (!LEVELS[key]) return;
    currentLevel = LEVELS[key];
    CONFIG.pipeSpeed = currentLevel.speed;
    CONFIG.gravity = currentLevel.gravity;
    CONFIG.pipeGap = currentLevel.gap;
    levelMenu.style.display = 'none';
    resetGame();
  };
});

/* ---------------- –°—Ç–∞—Ä—Ç ---------------- */
updateOverlay();
showLevelMenu();
requestAnimationFrame(loop);
</script>
</body>
</html>